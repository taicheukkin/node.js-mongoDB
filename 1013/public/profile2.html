<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>使用者資訊</title>
</head>
<body>
    <h2>歡迎，<span id="username"></span></h2>
    <p>您的角色：<span id="role"></span></p>
    <button id="logout">登出</button>
    <p id="message"></p>

    <!-- 以下程式碼負責讀取 JWT Token，並向伺服器 /profile 端點發送請求 -->
    <script>
        async function fetchProfile() {
            // localStorage.getItem('jwtToken') → 讀取瀏覽器儲存的 Token，確認使用者是否登入。
            // 如果沒有 Token，則顯示 "未登入，請先登入"。
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                document.getElementById('message').textContent = "未登入，請先登入";
                return;
            }

            try {
                // fetch('/profile', { ... }) → 向伺服器 /profile 端點發送 GET 請求。
                // headers: { ... } → 。在 HTTP 標頭中加入 Token
                const response = await fetch('/profile', {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();

                // response.ok → 檢查伺服器回應是否成功：
                // 成功 → 顯示 username 和 role。否則，顯示錯誤訊息。
                if (response.ok) {
                    document.getElementById('username').textContent = result.user.username;
                    document.getElementById('role').textContent = result.user.role;
                } else {
                    document.getElementById('message').textContent = result.message;
                }
            } catch (error) {
                console.error("獲取用戶資訊失敗:", error);
                document.getElementById('message').textContent = "無法獲取用戶資訊";
            }
        }

        // 登出功能
        document.getElementById('logout').addEventListener('click', () => {
            localStorage.removeItem('jwtToken');      // 清除 Token
            window.location.href = "/login_jwt.html"; // 跳轉回登入頁面
        });

        fetchProfile(); // 當頁面加載時獲取用戶資訊
    </script>
</body>
</html>


<!-- **********************************************************************************
// ************************************************************************************
// source: Copilot 
-->


